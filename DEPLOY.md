# Инструкция по развертыванию сервиса GigaVPN

Этот документ описывает шаги, необходимые для развертывания всего стека GigaVPN (бэкенд, бот, база данных) на чистом сервере с помощью Docker.

## 1. Требования

- **ОС:** Сервер с Linux (рекомендуется Debian 12 или Ubuntu 22.04).
- **Права доступа:** `root` или пользователь с `sudo`.
- **Установленный Git:** `sudo apt-get install git -y`.
- **Установленный Docker и Docker Compose:** Следуйте [официальной инструкции](https://docs.docker.com/engine/install/debian/) или воспользуйтесь нашим Ansible-плейбуком.
- **Токен Telegram-бота:** Полученный от `@BotFather`.

## 2. Клонирование репозитория

Подключитесь к вашему серверу по SSH и выполните следующую команду:

```bash
git clone git@github.com:Nepomnyashiy/gigavpn.git
cd gigavpn
```

## 3. Настройка переменных окружения

Сервису требуется токен Telegram-бота. Создайте файл `.env` в корне проекта для хранения этой переменной.

```bash
# Создаем .env файл и записываем в него токен
# Замените 'YOUR_SECRET_BOT_TOKEN' на ваш реальный токен
echo "BOT_TOKEN=YOUR_SECRET_BOT_TOKEN" > .env
```

**Внимание:** Файл `.env` по умолчанию игнорируется Git, поэтому ваш токен не попадет в репозиторий.

## 4. Запуск сервиса

Мы используем `docker-compose` для управления всеми сервисами. Для удобства в проекте есть `Makefile`.

Выполните следующую команду для сборки образов и запуска всех контейнеров в фоновом режиме:

```bash
make up
```

Эта команда выполнит `docker compose up -d --build --force-recreate`.

## 5. Проверка работоспособности

После завершения команды `make up` (это может занять несколько минут при первом запуске), проверьте статус контейнеров:

```bash
docker compose ps
```

Вы должны увидеть, что все контейнеры (`gigavpn_postgres`, `gigavpn_backend`, `gigavpn_bot`, `gigavpn_pgadmin`) находятся в состоянии `running` или `healthy`.

### Проверка логов

Если возникли проблемы, вы можете посмотреть логи каждого контейнера.

```bash
# Посмотреть логи всех сервисов "в прямом эфире"
make logs

# Посмотреть логи конкретного сервиса (например, бота)
docker logs gigavpn_bot
```

### Проверка бота в Telegram

- Откройте ваш Telegram-клиент.
- Найдите вашего бота.
- Отправьте команду `/start`.
- Бот должен ответить приветственным сообщением и показать статус бэкенда: `✅ Онлайн`.

## 6. Остановка сервиса

Для остановки всех сервисов выполните команду:

```bash
make down
```

Эта команда выполнит `docker compose down`, остановив и удалив все контейнеры, связанные с проектом. Данные в базе данных (том `postgres_data`) при этом сохранятся.
