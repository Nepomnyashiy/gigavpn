# Дневник Разработки: 08.12.2025

## **Выполненные задачи:**

### **Этап 0: Подготовка Структуры Проекта**
- **Инициализирован Monorepo:** Создана базовая структура директорий (`backend-go`, `bot-python`, `infrastructure`, `proto`).
- **Настроен Git:** Инициализирован локальный репозиторий, настроен удаленный репозиторий на GitHub (SSH), создан и настроен `.gitignore`.
- **Создан план разработки:** Детальный план сохранен в `dev/PLAN.md`.

### **Этап 1: Ядро Системы (MVP Core)**
- **Реализован каркас Go-приложения:** Создана структура проекта, инициализирован Go-модуль.
- **Реализована бизнес-логика:** Написаны функции для генерации VLESS UUID, ключей (заглушки) и итоговой ссылки для подключения.
- **Продемонстрирована работоспособность:** Создано консольное приложение, демонстрирующее генерацию ключа.

### **Этап 2: Слой Данных и API (Persistence & API)**
- **Развернута база данных:** В `docker-compose.yml` добавлены и запущены сервисы `PostgreSQL` и `pgAdmin`.
- **Созданы и применены миграции:** Написаны SQL-миграции для всех таблиц (`users`, `plans`, `servers` и т.д.) и успешно применены к базе данных.
- **Реализован слой репозитория:** Добавлен код для подключения к PostgreSQL с использованием `pgx`.
- **Реализован базовый REST API:** Добавлен веб-сервер на `Gin`, который успешно запускается и отвечает на тестовые запросы.

### **Этап 3: Пользовательский Интерфейс (Telegram Bot)**
- **Разработан базовый Telegram-бот:** Созданы структура проекта, API-клиент и обработчик команды `/start`.
- **Интегрирован с Docker:** Бот и бэкенд развернуты как Docker-контейнеры.
- **Продемонстрирована работоспособность:** Бот успешно запущен, подключен к Telegram и взаимодействует с бэкендом, показывая его статус "✅ Онлайн".

### **Этап 4: Автоматизация Инфраструктуры (IaC)**
- **Создан Makefile:** Добавлен `Makefile` для автоматизации рутинных команд (`up`, `down`, `logs`, `db-migrations` и т.д.).
- **Разработан базовый плейбук Ansible:** Создана структура и плейбук для автоматической настройки VPN-узла (установка Docker, настройка сети).

## **Проблемы и решения:**
- Возникли проблемы с запуском Docker-контейнеров из-за отсутствия прав у пользователя. Проблема решена добавлением пользователя в группу `docker`.
- Возникали сложности с запуском Go-сервера в фоновом режиме. Проблема решена путем более тщательной диагностики и проверки логов.
- **Бесшумное падение бота:** Вызвано ошибками в конфигурации `httpx` (некорректное отключение прокси) и устаревшим синтаксисом `aiogram`.
- **Проблемы сборки Docker-образов:** Несоответствие версии Go в `Dockerfile` и `go.mod`, отсутствие `curl` в образе Go-бэкенда для healthcheck.
- **Проблемы с подключением бота к бэкенду:** Первоначально вызваны некорректной настройкой `httpx` и потенциальными проблемами с DNS-разрешением внутри Docker. Окончательно решены переходом на `aiohttp` и использованием имени сервиса для `BACKEND_URL`.
- **Кэш Docker:** Проблема `parent snapshot ... does not exist` решена очисткой кеша `docker builder prune`.

## **Планы на следующий день:**
- Приступить к **Этапу 5: CI/CD и Мониторинг**.
